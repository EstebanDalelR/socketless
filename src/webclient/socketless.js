export const socketlessjs = atob("LyoqCiAqIFRoaXMgZmlsZSBob3VzZXMgdGhlIGNvcmUgb2YgdGhlIFJQQyBmdW5jdGlvbmFsaXR5LgogKgogKiBUaGUgYFVwZ3JhZGVkU29ja2V0YCBjbGFzcyBpcyBhbiBleHRlbnNpb24gb24gdGhlIFdlYlNvY2tldCBjbGFzcyB0aGF0IGFkZHMKICogY3VzdG9tIG9uL29mZi9zZW5kIG1ldGhvZHMgKGV4cG9zZWQgdGhyb3VnaCBhIHNvY2tldC51cGdyYWRlZCBvYmplY3QpLCBzZXQKICogdXAgdG8gaGFuZGxlIGF1dG9tYXRpYyByZXNwb25zZXMgdG8gY2FsbHMuIEluY29taW5nIFdlYlNvY2tldCBtZXNzYWdlcyBhcmUKICogcm91dGVkIGludG8gdGhlIGByb3V0ZXJgIGZ1bmN0aW9uLCB3aGljaCBoYXMgYmVoYXZpb3VyIHRhaWxvcmVkIHRvIHNwZWNpZmljCiAqIG9yaWdpbnMsIGFuZCBtYWtlcyBzdXJlIHRoYXQgbWVzc2FnZXMgYXJlIGFsd2F5cyByZXNwb25kZWQgdG8uCiAqCiAqIFRoZSBgX19zZW5kYCBmdW5jdGlvbiwgaW4gdHVybiwgZG9lc24ndCBqdXN0IHNlbmQgZGF0YSBvdmVyIHRvIGEgcmVtb3RlLCBidXQKICogYWxzbyB3YWl0cyBmb3IgdGhhdCByZW1vdGUncyA6cmVzcG9uc2UgbWVzc2FnZSwgdXNpbmcgUHJvbWlzZXMgdG8gbWFrZQogKiBzdXJlIHRoYXQgYW55b25lIGNhbiBgYXdhaXQgc29ja2V0LnVwZ3JhZGVkLnNlbmQoLi4uKWAgYW5kIGdldCBhIHJlc3BvbnNlCiAqIG9uY2UgdGhhdCByZXNwb25zZSBoYXMgYmVlbiBzZW50IGJhY2suIEFzIGZhciBhcyBjYWxsaW5nIGNvZGUgaXMgY29uY2VybmVkLAogKiB0aGlzIGlzIGEgbm9ybWFsIGFzeW5jIGNhbGwsIGFuZCB0aGUgZmFjdCB0aGF0IG5ldHdvcmsgdHJhbnNwb3J0IGhhcHBlbmVkCiAqIGlzIGVudGlyZWx5IGlycmVsZXZhbnQuIENhbGxlcnMgc2hvdWxkIG5vdCBjYXJlLgogKgogKiBUaGUgYFNvY2tldFByb3h5YCBpcyBhIGNsZXZlciBsaXR0bGUgUHJveHkgb2JqZWN0IHRoYXQgZXh0ZW5kcyB0aGUgRnVuY3Rpb24KICogYnVpbHQtaW4sIHdoaWNoIGFsbG93cyB1cyB0byBjcmVhdGUgYSByZWN1cnNpdmUgb2JqZWN0IHdoZXJlIGFueSBwcm9wZXJ0eQogKiBvbiBpdCBpcyBhIHZhbGlkIGZ1bmN0aW9uIHRvIGNhbGwsIGFuZCBkb2luZyBzbyB3aWxsIHNlbmQgdGhlIGNvcnJlc3BvbmRpbmcKICogY2FsbCBjaGFpbiBvdmVyIHRvIHRoZSByZW1vdGUgZm9yIGV4ZWN1dGlvbiBhbmQgcmVzcG9uc2UgbWVzc2FnaW5nLiBUaGlzIHdheSwKICogd2UgZG9uJ3QgbmVlZCB0byBwZXJmb3JtIGFueSAid2hpY2ggZnVuY3Rpb25zIGFyZSBzdXBwb3J0ZWQiLCB3ZSBjYW4ganVzdCBwcm94eQogKiB0aGUgY2FsbCBvdmVyIHRoZSBuZXR3b3JrLCBpZiBpdCBleGlzdHMsIGl0IHJ1bnMsIGlmIGl0IGRvZXNuJ3QsIHRoZW4gd2UnbGwKICogZ2V0IGEgcmVzdWx0IGJhY2sgd2l0aCBhbiBgZXJyb3JgIG1lc3NhZ2UgdGhhdCB3ZSBjYW4gdHVybiBpbnRvIGEgbG9jYWwgdGhyb3cuCiAqLwoKCmNvbnN0IEJST1dTRVIgPSAiYnJvd3NlciI7CmNvbnN0IENMSUVOVCA9ICJjbGllbnQiOwoKY2xhc3MgUlBDRXJyb3IgewogIGNvbnN0cnVjdG9yKG9yaWdpbk5hbWUsIG1lc3NhZ2UpIHsKICAgIHRoaXMub3JpZ2luTmFtZSA9IG9yaWdpbk5hbWU7CiAgICB0aGlzLm1lc3NhZ2UgPSBtZXNzYWdlOwogIH0KfQoKY29uc3QgREVCVUcgPSBmYWxzZTsKCi8vIGltcG9ydGluZyB0aGUgdXVpZCBwYWNrYWdlIGlzIHdheSB0b28gZXhwZW5zaXZlIGZvciB3aGF0IHdlIG5lZWQgaGVyZQpmdW5jdGlvbiB1dWlkKCkgewogIGNvbnN0IG5vdyA9IERhdGUubm93KCkudG9TdHJpbmcoMTYpOwogIGNvbnN0IHJkbSA9ICgoMWU2ICogTWF0aC5yYW5kb20oKSkgfCAwKS50b1N0cmluZygxNik7CiAgcmV0dXJuIGAke25vd30tJHtyZG19YDsKfQoKLy8gcmVzcG9uc2VzIHNob3VsZCBhbHdheXMgYmUgInRoZSBldmVudCBuYW1lLCB3aXRoIDpyZXNwb25zZSBhZGRlZCIKZXhwb3J0IGNvbnN0IFJFU1BPTlNFX1NVRkZJWCA9IGA6cmVzcG9uc2VgOwpleHBvcnQgY29uc3QgZ2V0UmVzcG9uc2VOYW1lID0gKGV2ZW50TmFtZSkgPT4gYCR7ZXZlbnROYW1lfSR7UkVTUE9OU0VfU1VGRklYfWA7CgovLyB1c2Ugc3ltYm9scyBzbyB3ZSBkb24ndCBwb2xsdXRlIHRoZSBzb2NrZXQgcHJvdG90eXBlCmNvbnN0IE9SSUdJTiA9IFN5bWJvbChgb3JpZ2luYCk7CmNvbnN0IFBST1hZID0gU3ltYm9sKGBwcm94eWApOwpjb25zdCBSRUNFSVZFUiA9IFN5bWJvbChgcmVjZWl2ZXJgKTsKY29uc3QgUkVNT1RFID0gU3ltYm9sKGByZW1vdGVgKTsKY29uc3QgSEFORExFUlMgPSBTeW1ib2woYGhhbmRsZXJzYCk7CgovKioKICogLi4uZG8gZG9jcyBnbyBoZXJlPwogKi8KY2xhc3MgVXBncmFkZWRTb2NrZXQgZXh0ZW5kcyBXZWJTb2NrZXQgewogIFtPUklHSU5dID0gdW5kZWZpbmVkOyAvLyB0aGUgc29ja2V0IG93bmVyIHdobyBpbnZva2VkIHRoZSB1cGdyYWRlLiBTZWUgdXBncmFkZSgpCiAgW1BST1hZXSA9IHVuZGVmaW5lZDsgLy8gdGhlIHByb3h5IG9iamVjdCBhc3NvY2lhdGVkIHdpdGggdGhpcyBzb2NrZXQKICBbUkVDRUlWRVJdID0gYGA7IC8vIG5hbWUgb2YgdGhlIHJlY2VpdmluZyBvYmplY3QKICBbUkVNT1RFXSA9IGBgOyAvLyBuYW1lIG9mIHRoZSByZW1vdGUgb2JqZWN0CiAgW0hBTkRMRVJTXSA9IHt9OyAvLyB0aGUgbGlzdCBvZiBldmVudCBoYW5kbGVycy4gU2VlIHVwZ3JhZGUoKQoKICAvLyBleHBsaWNpdGx5IGZvcmJpZCB0aGUgY29uc3RydWN0b3IgZnJvbSBiZWluZyB1c2VkLgogIC8vIEB0cy1pZ25vcmU6IHdlIGRvbid0IG5lZWQgdG8gY2FsbCBzdXBlcigpIGlmIHdlIGVycm9yIG91dC4KICBjb25zdHJ1Y3RvcigpIHsKICAgIHRocm93IG5ldyBFcnJvcigKICAgICAgIkNhbm5vdCBjcmVhdGUgVXBncmFkZWRTb2NrZXQgaW5zdGFuY2VzLiBVc2UgVXBncmFkZWRTb2NrZXQudXBncmFkZShuYW1lLCBvcmlnaW4sIHNvY2tldCkgaW5zdGVhZC4iLAogICAgKTsKICB9CgogIC8vIHVwZ3JhZGUgYSBzb2NrZXQgZnJvbSBwbGFpbiBXZWJTb2NrZXQgdG8gdGhpcyBjbGFzcyBpbnN0ZWFkLgogIHN0YXRpYyB1cGdyYWRlKHNvY2tldCwgb3JpZ2luLCByZWNlaXZlciwgcmVtb3RlKSB7CiAgICBpZiAoc29ja2V0IGluc3RhbmNlb2YgVXBncmFkZWRTb2NrZXQpIHJldHVybiBzb2NrZXQ7CiAgICAvLyB1cGRhdGUgdGhlIHByb3RvdHlwZSBiaW5kaW5nCiAgICBPYmplY3Quc2V0UHJvdG90eXBlT2Yoc29ja2V0LCBVcGdyYWRlZFNvY2tldC5wcm90b3R5cGUpOwogICAgLy8gbWFrZSBzdXJlIHRoYXQgbWVzc2FnZXMgZ28gdGhyb3VnaCB0aGUgcm91dGVyOgogICAgc29ja2V0W09SSUdJTl0gPSBvcmlnaW47CiAgICBzb2NrZXRbUkVDRUlWRVJdID0gcmVjZWl2ZXI7CiAgICBzb2NrZXRbUkVNT1RFXSA9IHJlbW90ZTsKICAgIHNvY2tldFtIQU5ETEVSU10gPSB7fTsKICAgIGNvbnN0IG1lc3NhZ2VSb3V0ZXIgPSBzb2NrZXQucm91dGVyLmJpbmQoc29ja2V0KTsKICAgIGlmIChzb2NrZXQub24pIHsKICAgICAgc29ja2V0Lm9uKGBtZXNzYWdlYCwgbWVzc2FnZVJvdXRlcik7CiAgICB9IGVsc2UgewogICAgICBzb2NrZXQub25tZXNzYWdlID0gbWVzc2FnZVJvdXRlcjsKICAgIH0KCiAgICAvLyBjb252ZW5pZW5jZSByZXR1cm4uCiAgICByZXR1cm4gc29ja2V0OwogIH0KCiAgLy8gU3BlY2lhbCBhY2Nlc3NvciBmb3IgdXBncmFkZWQgc29ja2V0IGZ1bmN0aW9ucywKICBnZXQgdXBncmFkZWQoKSB7CiAgICBpZiAoIXRoaXMuX191cGdyYWRlZCkgewogICAgICB0aGlzLl9fdXBncmFkZWQgPSB7CiAgICAgICAgb246ICguLi5hcmdzKSA9PiB0aGlzLl9fb24oLi4uYXJncyksCiAgICAgICAgb2ZmOiAoLi4uYXJncykgPT4gdGhpcy5fX29mZiguLi5hcmdzKSwKICAgICAgICBzZW5kOiAoLi4uYXJncykgPT4gdGhpcy5fX3NlbmQoLi4uYXJncyksCiAgICAgIH07CiAgICB9CiAgICByZXR1cm4gdGhpcy5fX3VwZ3JhZGVkOwogIH0KCiAgLy8gbWVzc2FnZSByb3V0ZXIgc3BlY2lmaWNhbGx5IGZvciB0aGUgbWVzc2FnZSBmb3JtYXQgdXNlZCBieSB0aGUgc29ja2V0bGVzcyBjb2RlLgogIGFzeW5jIHJvdXRlcihtZXNzYWdlLCBmb3JjZWQgPSBmYWxzZSkgewogICAgY29uc3QgeyBbT1JJR0lOXTogb3JpZ2luLCBbUkVDRUlWRVJdOiByZWNlaXZlciwgW1JFTU9URV06IHJlbW90ZSB9ID0gdGhpczsKCiAgICAvLyBBbnkgY2FsbHMgZnJvbSB0aGUgYnJvd3NlciB0byB0aGUgd2ViY2xpZW50IGFyZSB0aGF0J3MgYWxyZWFkeSBoYW5kbGVkCiAgICAvLyBieSB0aGUgd2Vic29ja2V0IGRpcmVjdGx5IChzZWUgdGhlIGNyZWF0ZVdlYkNsaWVudCBmdW5jdGlvbiBpbiBpbmRleC5qcywKICAgIC8vIGluIHRoZSB3cy5vbihgY29ubmVjdGlvbmAsIC4uLikgYmxvY2spLCBzbyB3ZSBuZWVkIHRvIG1ha2Ugc3VyZSB0byBub3QKICAgIC8vIHRyeSB0byAiZG91YmxlLWhhbmRsZSIgdGhhdDoKICAgIGlmIChyZW1vdGUgPT09IEJST1dTRVIgJiYgIWZvcmNlZCkgewogICAgICByZXR1cm47CiAgICB9CgogICAgLy8gYnJvd3NlciB3ZWJzb2NrZXQ/IElmIHNvLCB1bndyYXAgdGhlIGRhdGEKICAgIGlmIChtZXNzYWdlLnNyY0VsZW1lbnQpIHsKICAgICAgbWVzc2FnZSA9IG1lc3NhZ2UuZGF0YTsKICAgIH0KCiAgICBsZXQgZGF0YTsKCiAgICB0cnkgewogICAgICBkYXRhID0gSlNPTi5wYXJzZShtZXNzYWdlKTsKICAgIH0gY2F0Y2ggKGUpIHsKICAgICAgcmV0dXJuIGNvbnNvbGUuZXJyb3IoYENvdWxkIG5vdCBwYXJzZSB3ZWJzb2NrZXQgZGF0YTogJHttZXNzYWdlfWApOwogICAgfQoKICAgIGNvbnN0IHsgbmFtZTogZXZlbnROYW1lLCBwYXlsb2FkLCBlcnJvcjogZXJyb3JNc2csIGRpZmYsIHNlcV9udW0gfSA9IGRhdGE7CiAgICBsZXQgeyBzdGF0ZSB9ID0gZGF0YTsKICAgIGxldCB0aHJvd2FibGUgPSBlcnJvck1zZyA/IG5ldyBSUENFcnJvcihyZWNlaXZlciwgZXJyb3JNc2cpIDogdW5kZWZpbmVkOwoKICAgIGlmIChERUJVRykKICAgICAgY29uc29sZS5sb2coYFske3JlY2VpdmVyfV0vWyR7cmVtb3RlfV0gcm91dGVyIHJ1bm5pbmcgZ2l2ZW46YCwgewogICAgICAgIGV2ZW50TmFtZSwKICAgICAgICBwYXlsb2FkLAogICAgICAgIGVycm9yTXNnLAogICAgICAgIHN0YXRlLAogICAgICAgIGRpZmYsCiAgICAgICAgc2VxX251bSwKICAgICAgfSk7CgogICAgLy8gQ2xpZW50LXN0YXRlIHN5bmNocm9uaXphdGlvbiBtZWNoYW5pc20gZm9yIHRoZSBicm93c2VyOgogICAgaWYgKHN0YXRlICYmIHJlY2VpdmVyID09PSBCUk9XU0VSKSB7CiAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYGhhbmRsaW5nIHN0YXRlIHVwZGF0ZSBpbiB0aGUgYnJvd3NlcmAsIHN0YXRlKTsKICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmxvZyhgb3JpZ2luIG9iamVjdDpgLCB7IG9yaWdpbiB9KTsKICAgICAgY29uc3QgcHJldlN0YXRlID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShvcmlnaW4uc3RhdGUpKTsKICAgICAgaWYgKGRpZmYpIHsKICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGByZWNlaXZlZCBkaWZmYCwgc3RhdGUpOwogICAgICAgIGNvbnN0IHBhdGNoID0gc3RhdGU7CiAgICAgICAgbGV0IHRhcmdldDsKICAgICAgICAvLyB2ZXJpZnkgd2UncmUgc3RpbGwgaW4gc3luYyBieSBjb21wYXJpbmcgbWVzc2FnaW5nIHNlcXVlbmNlIG51bWJlcnMKICAgICAgICBpZiAoc2VxX251bSA9PT0gb3JpZ2luLl9fc2VxX251bSArIDEpIHsKICAgICAgICAgIG9yaWdpbi5fX3NlcV9udW0gPSBzZXFfbnVtOwogICAgICAgICAgdGFyZ2V0ID0gSlNPTi5wYXJzZShKU09OLnN0cmluZ2lmeShwcmV2U3RhdGUpKTsKICAgICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYGFwcGx5aW5nIHBhdGNoIHRvYCwgdGFyZ2V0KTsKICAgICAgICAgIC8vIEB0cy1pZ25vcmU6IHRoaXMgb25seSBydW5zIGluIHRoZSBicm93c2VyLCB3aGVyZSByZmM2OTAyIGlzIGEgZ2xvYmFsLgogICAgICAgICAgcmZjNjkwMi5hcHBseVBhdGNoKHRhcmdldCwgcGF0Y2gpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAvLyBpZiB3ZSBnZXQgaGVyZSwgd2UncmUgbm90IGluIHN5bmMsIGFuZCB3ZSBuZWVkIHRvIHJlcXVlc3QgYSBmdWxsCiAgICAgICAgICAvLyBzdGF0ZSBvYmplY3QgaW5zdGVhZCBvZiB0cnlpbmcgdG8gYXBwbHkgZGlmZmVyZW50aWFsIHVwZGF0ZXMuCiAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBzZXFfbnVtIG1pc21hdGNoLCBzeW5jaW5nIHN0YXRlYCk7CiAgICAgICAgICBjb25zdCBmdWxsU3RhdGUgPSBhd2FpdCB0aGlzLl9fc2VuZChgc3luY1N0YXRlYCk7CiAgICAgICAgICBvcmlnaW4uX19zZXFfbnVtID0gMDsKICAgICAgICAgIHRhcmdldCA9IGZ1bGxTdGF0ZTsKICAgICAgICB9CiAgICAgICAgc3RhdGUgPSB0YXJnZXQ7CiAgICAgIH0KICAgICAgLy8gUnVuIHRoZSB1cGRhdGUgd2l0aCB0aGUgbmV3IHN0YXRlIGFzIGFyZ3VtZW50IGZpcnN0LCB0aGVuCiAgICAgIC8vIG92ZXJ3cml0ZSB0aGUgb2xkIHN0YXRlIHdpdGggdGhlIG5ldyBzdGF0ZSBhZnRlciB0aGUgdXBkYXRlLgogICAgICBvcmlnaW4uc3RhdGUgPSBzdGF0ZTsKICAgICAgcmV0dXJuIG9yaWdpbi51cGRhdGU/LihwcmV2U3RhdGUpOwogICAgfQoKICAgIC8vIElmIHRoaXMgaXMgYSByZXNwb25zZSBtZXNzYWdlLCBydW4gdGhlIGBvbmAgaGFuZGxlciBmb3IgdGhhdC4KICAgIGlmIChldmVudE5hbWUuZW5kc1dpdGgoUkVTUE9OU0VfU1VGRklYKSkgewogICAgICBjb25zdCB7IFtIQU5ETEVSU106IGhhbmRsZXJzIH0gPSB0aGlzOwogICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBbJHtyZWNlaXZlcn1dIHJlc3BvbnNlIG1lc3NhZ2UgcmVjZWl2ZWRgKTsKICAgICAgaWYgKCFoYW5kbGVyc1tldmVudE5hbWVdKSB0aHJvdyBuZXcgRXJyb3IoYG5vIGhhbmRsZXJzIGZvciAke2V2ZW50TmFtZX1gKTsKICAgICAgaGFuZGxlcnNbZXZlbnROYW1lXS5mb3JFYWNoKChoYW5kbGVyKSA9PiB7CiAgICAgICAgaGFuZGxlcih0aHJvd2FibGUgPyB0aHJvd2FibGUgOiBwYXlsb2FkKTsKICAgICAgfSk7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICAvLyBJZiBpdCdzIGEgcmVxdWVzdCBtZXNzYWdlLCByZXNvbHZlIGl0IHRvIGEgZnVuY3Rpb24gY2FsbCBhbmQgInJldHVybiIKICAgIC8vIHRoZSB2YWx1ZSBieSBzZW5kaW5nIGEgOnJlc3BvbnNlIG1lc3NhZ2Ugb3ZlciB0aGUgd2Vic29ja2V0IGluc3RlYWQuCiAgICBjb25zdCBzdGFnZXMgPSBldmVudE5hbWUuc3BsaXQoYDpgKTsKICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYFske3JlY2VpdmVyfV0gcm91dGVyOiBzdGFnZXM6YCwgc3RhZ2VzKTsKCiAgICAvLyBwbGFjZWhvbGRlcnMgZm9yIG91ciByZXNwb25zZSBhbmQgcG90ZW50aWFsIGNhbGwgZXJyb3JzCiAgICBsZXQgcmVzcG9uc2UgPSB1bmRlZmluZWQ7CiAgICBsZXQgZXJyb3IgPSB1bmRlZmluZWQ7CgogICAgLy8gQXJlIHdlIGV2ZW4gYWxsb3dlZCB0byByZXNvbHZlIHRoaXMgY2hhaW4/CiAgICBjb25zdCBbZmlyc3RdID0gc3RhZ2VzOwogICAgbGV0IGZvcmJpZGRlbiA9IG9yaWdpbi5fX3Byb3RvX18/LmNvbnN0cnVjdG9yLmRpc2FsbG93ZWRDYWxscyA/PyBbXTsKICAgIGlmIChmaXJzdCAmJiBmb3JiaWRkZW4uaW5jbHVkZXMoZmlyc3QpKSB7CiAgICAgIGVycm9yID0gYElsbGVnYWwgY2FsbDogJHtmaXJzdH0gaXMgYSBwcm90ZWN0ZWQgcHJvcGVydHlgOwogICAgfQoKICAgIC8vIFdlJ2xsIGJlIHN0ZXBwaW5nIGludG8gImNhbGxhYmxlIiwgbWFraW5nIHN1cmUgdGhhdCBlYWNoIHRpbWUKICAgIC8vIHdlIHN0ZXAgZGVlcGVyLCB3ZSB1cGRhdGUgdGhlIGNhbGwgY29udGV4dCB0byB0aGUKICAgIGxldCBjb250ZXh0ID0gb3JpZ2luOwogICAgbGV0IGNhbGxhYmxlID0gb3JpZ2luOwoKICAgIC8vIFdlIGFyZTogZmluZCB0aGUgYWN0dWFsIGZ1bmN0aW9uIHRvIGNhbGwuCiAgICBpZiAoIWVycm9yKSB7CiAgICAgIHRyeSB7CiAgICAgICAgd2hpbGUgKHN0YWdlcy5sZW5ndGgpIHsKICAgICAgICAgIGNvbnN0IHN0YWdlID0gc3RhZ2VzLnNoaWZ0KCk7CiAgICAgICAgICBpZiAoREVCVUcpIGNvbnNvbGUubG9nKGBjaGVja2luZyAke3N0YWdlfWApOwogICAgICAgICAgY29udGV4dCA9IGNhbGxhYmxlOwogICAgICAgICAgY2FsbGFibGUgPSBjYWxsYWJsZVtzdGFnZV07CiAgICAgICAgfQogICAgICAgIC8vIElmIHRoaXMgY29kZSBydW5zIG9uIHRoZSBzZXJ2ZXIsIHRoZSBmdW5jdGlvbiBuZWVkcyB0byBiZQogICAgICAgIC8vIGNhbGxlZCB3aXRoIHRoZSBjbGllbnQgcHJveHkgYXMgZmlyc3QgYXJndW1lbnQuCiAgICAgICAgaWYgKHJlY2VpdmVyID09PSBgc2VydmVyYCkgcGF5bG9hZC51bnNoaWZ0KHRoaXNbUFJPWFldKTsKICAgICAgfSBjYXRjaCAoZSkgewogICAgICAgIC8vICJmdW5jdGlvbiBub3QgZm91bmQiIGRvZXNuJ3QgY291bnQgYXMgZXJyb3IgImhlcmUiLgogICAgICAgIC8vIEluc3RlYWQsIHdlIHNlbmQgdGhhdCBiYWNrIHRvIHRoZSBjYWxsZXIuCiAgICAgICAgaWYgKERFQlVHKQogICAgICAgICAgY29uc29sZS5lcnJvcihgY2Fubm90IHJlc29sdmUgJHtldmVudE5hbWV9IG9uICR7cmVjZWl2ZXJ9YCwgZSk7CiAgICAgICAgZXJyb3IgPSBlLm1lc3NhZ2U7CiAgICAgIH0KICAgIH0KCiAgICAvLyBSZXNvbHZlIHRoZSBmdW5jdGlvbiBhbmQgdGhlbiBzZW5kIHRoZSByZXN1bHQgYXMgOnJlc3BvbnNlLCBtYWtpbmcKICAgIC8vIHN1cmUgdG8gdGFrZSBpbnRvIGFjY291bnQgdGhhdCBhIGNhbGwgaXRzZWxmIG1pZ2h0IHRocm93LgogICAgaWYgKCFlcnJvcikgewogICAgICB0cnkgewogICAgICAgIHJlc3BvbnNlID0gKGF3YWl0IGNhbGxhYmxlLmFwcGx5KC4uLnBheWxvYWQpKSA/PyB0cnVlOwogICAgICAgIC8vIElmIHRoaXMgaXMgYSB3ZWJjbGllbnQsIGFuZCB0aGVyZSBpcyBhIGJyb3dzZXIgY29ubmVjdGVkLAogICAgICAgIC8vIGFsc28gbWFrZSBzdXJlIHRvIHRyaWdnZXIgYSBzdGF0ZSBzeW5jLCBzbyB0aGF0IGNsaWVudCBjb2RlCiAgICAgICAgLy8gZG9lcyBub3QgbmVlZCB0byBpbmNsdWRlIHNldFN0YXRlIGNhbGxzIGFsbCBvdmVyIHRoZSBwbGFjZS4KICAgICAgICBpZiAocmVjZWl2ZXIgPT09IENMSUVOVCAmJiBvcmlnaW4uYnJvd3NlcikgewogICAgICAgICAgb3JpZ2luLnNldFN0YXRlKG9yaWdpbi5zdGF0ZSk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgaWYgKERFQlVHKQogICAgICAgICAgY29uc29sZS5lcnJvcigKICAgICAgICAgICAgYGZ1bmN0aW9uIGludm9jYXRpb24gZm9yICR7ZXZlbnROYW1lfSBmYWlsZWQgb24gJHtyZWNlaXZlcn0sIHBheWxvYWQ6YCwKICAgICAgICAgICAgcGF5bG9hZCwKICAgICAgICAgICk7CiAgICAgICAgaWYgKERFQlVHKSBjb25zb2xlLmVycm9yKGUpOwogICAgICAgIGVycm9yID0gYENhbm5vdCBjYWxsIFtbJHtyZWNlaXZlcn1dXS4ke2V2ZW50TmFtZS5yZXBsYWNlQWxsKAogICAgICAgICAgYDpgLAogICAgICAgICAgYC5gLAogICAgICAgICl9LCBmdW5jdGlvbiBpcyBub3QgZGVmaW5lZC5gOwogICAgICB9CiAgICB9CgogICAgLy8gU2VuZCBvZmYgYSByZXNwb25zZSBtZXNzYWdlIHdpdGggZWl0aGVyIHRoZSByZXN1bHQsIG9yIHRoZSBlcnJvci4KICAgIGNvbnN0IHJlc3BvbnNlTmFtZSA9IGdldFJlc3BvbnNlTmFtZShldmVudE5hbWUpOwogICAgaWYgKERFQlVHKQogICAgICBjb25zb2xlLmxvZyhgWyR7cmVjZWl2ZXJ9XSBzZW5kaW5nICR7cmVzcG9uc2VOYW1lfWAsIHsKICAgICAgICBwYXlsb2FkOiByZXNwb25zZSwKICAgICAgICBlcnJvciwKICAgICAgfSk7CiAgICBzdXBlci5zZW5kKAogICAgICBKU09OLnN0cmluZ2lmeSh7IG5hbWU6IHJlc3BvbnNlTmFtZSwgcGF5bG9hZDogcmVzcG9uc2UsIGVycm9yIH0pLAogICAgKTsKICB9CgogIC8qKgogICAqIHRoaXMudXBncmFkZWQub24oKSBtYWRlIHRvIHdvcmsgbGlrZSAuYWRkRXZlbnRMaXN0ZW5lcigpCiAgICovCiAgX19vbihldmVudE5hbWUsIGhhbmRsZXIpIHsKICAgIGNvbnN0IHsgW0hBTkRMRVJTXTogaGFuZGxlcnMgfSA9IHRoaXM7CiAgICBpZiAoIWhhbmRsZXJzW2V2ZW50TmFtZV0pIGhhbmRsZXJzW2V2ZW50TmFtZV0gPSBbXTsKICAgIGhhbmRsZXJzW2V2ZW50TmFtZV0ucHVzaChoYW5kbGVyKTsKICAgIC8vIHJldHVybiB0aGUgY29ycmVzcG9uZGluZyAib2ZmIiBmdW5jdGlvbiwgZm9yIGNvbnZlbmllbmNlLgogICAgcmV0dXJuICgpID0+IHRoaXMuX19vZmYoZXZlbnROYW1lLCBoYW5kbGVyKTsKICB9CgogIC8qKgogICAqIHRoaXMudXBncmFkZWQub2ZmKCkgbWFkZSB0byB3b3JrIGxpa2UgLnJlbW92ZUV2ZW50TGlzdGVuZXIoKQogICAqLwogIF9fb2ZmKGV2ZW50TmFtZSwgaGFuZGxlcikgewogICAgY29uc3QgeyBbSEFORExFUlNdOiBoYW5kbGVycyB9ID0gdGhpczsKICAgIGlmICghaGFuZGxlcnNbZXZlbnROYW1lXSkgcmV0dXJuOwogICAgY29uc3QgcG9zID0gaGFuZGxlcnNbZXZlbnROYW1lXS5pbmRleE9mKGhhbmRsZXIpOwogICAgaGFuZGxlcnNbZXZlbnROYW1lXS5zcGxpY2UocG9zLCAxKTsKICB9CgogIC8qKgogICAqIEFkZCBhIHByb21pc2UtYmFzZWQgZW1pdC9yZWNlaXZlIHRvIHRoZSBzb2NrZXQsIHNvIHRoYXQgY2FsbGluZyBjb2RlIGNhbiBgYXdhaXRgIHRoZSByZXNwb25zZS4KICAgKgogICAqIE5vdGUgdGhhdCB0aGVyZSBpcyBhbiBvcHRpb25hbCB0aGlyZCBhcmd1bWVudCBgdGltZW91dGAgdGhhdCBjYW4gYmUgdXNlZCB0byBzYXkgaG93IGxvbmcgdGhlCiAgICogZW1pdCBzaG91bGQgd2FpdCBiZWZvcmUgZGVjaWRpbmcgdGhlcmUgaXMgbm8gcmVzcG9uc2UgZm9ydGhjb21pbmcgYW5kIHRvIGNsZWFuIHVwIHRoZSBldmVudAogICAqIGxpc3RlbmVyIGZvciB0aGF0IHJlc3BvbnNlLiBUaGUgZGVmYXVsdCB0aW1lb3V0IGlzIDEwMDBtcy4KICAgKi8KICBhc3luYyBfX3NlbmQoZXZlbnROYW1lLCBkYXRhID0ge30sIHRpbWVvdXQgPSAxMDAwKSB7CiAgICBjb25zdCB7IFtSRUNFSVZFUl06IHJlY2VpdmVyLCBbUkVNT1RFXTogcmVtb3RlIH0gPSB0aGlzOwogICAgaWYgKERFQlVHKQogICAgICBjb25zb2xlLmxvZyhgWyR7cmVjZWl2ZXJ9XSBzZW5kaW5nIFske2V2ZW50TmFtZX1dIHRvIFske3JlbW90ZX1dOmAsIGRhdGEpOwogICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHsKICAgICAgY29uc3QgcmVzcG9uc2VOYW1lID0gZ2V0UmVzcG9uc2VOYW1lKGV2ZW50TmFtZSk7CgogICAgICAvLyBjbGVhbnVwIGZ1bmN0aW9uIGZvciB0aGUgZXZlbnQgbGlzdGVuZXIKICAgICAgbGV0IGNsZWFudXAgPSAoZGF0YSA9IHVuZGVmaW5lZCkgPT4gewogICAgICAgIGlmIChERUJVRykgY29uc29sZS5sb2coYFske3JlY2VpdmVyfV0gY2xlYW51cGApOwogICAgICAgIC8vIGNsZWFuIHVwIGFuZCBiZWNvbWUgYSBub29wIHNvIHdlIGNhbid0IGJlIHJldHJpZ2dlcmVkLgogICAgICAgIHRoaXMuX19vZmYocmVzcG9uc2VOYW1lLCBoYW5kbGVyKTsKICAgICAgICBjbGVhbnVwID0gKCkgPT4ge307CiAgICAgICAgcmVzb2x2ZShkYXRhKTsKICAgICAgfTsKCiAgICAgIC8vIEluIG9yZGVyIHRvIHJlc29sdmUgdGhlIFByb21pc2UsIHdlIHdpbGwgYmUgbGlzdGVuaW5nCiAgICAgIC8vIGZvciB0aGF0IGV2ZW50TmFtZTpyZXNwb25zZSwgYW5kIHdoZW4gd2UgcmVjZWl2ZSBpdCwKICAgICAgLy8gd2UnbGwgaW1tZWRpYXRlbHkgU1RPUCBsaXN0ZW5pbmcgZm9yIHNpbWlsYXIgcmVzcG9uc2VzCiAgICAgIC8vIGJlY2F1c2Ugd2Ugbm8gbG9uZ2VyIGNhcmUuCiAgICAgIGNvbnN0IGhhbmRsZXIgPSAoZGF0YSkgPT4gY2xlYW51cChkYXRhKTsKCiAgICAgIC8vIEZpcnN0LCBtYWtlIHN1cmUgd2UncmUgcmVhZHkgdG8gcmVjZWl2ZSB0aGUgcmVzcG9uc2UuLi4KICAgICAgdGhpcy5fX29uKHJlc3BvbnNlTmFtZSwgKGRhdGEpID0+IHsKICAgICAgICBpZiAoREVCVUcpCiAgICAgICAgICBjb25zb2xlLmxvZygKICAgICAgICAgICAgYFske3JlY2VpdmVyfV0gaGFuZGxpbmcgcmVzcG9uc2UgZm9yICR7ZXZlbnROYW1lfSBmcm9tIFske3JlbW90ZX1dOmAsCiAgICAgICAgICApOwogICAgICAgIGhhbmRsZXIoZGF0YSk7CiAgICAgIH0pOwoKICAgICAgLy8gQW5kIHRoZW4sIHNlbmQgdGhlIGV2ZW50IG9mZiB0byB0aGUgY2xpZW50LgogICAgICBjb25zdCBzZW5kRXZlbnQgPSAoKSA9PiB7CiAgICAgICAgaWYgKERFQlVHKQogICAgICAgICAgY29uc29sZS5sb2coCiAgICAgICAgICAgIGAocmF3KSBzZW5kaW5nICR7ZXZlbnROYW1lfSBmcm9tICR7cmVjZWl2ZXJ9IHRvICR7cmVtb3RlfWAsCiAgICAgICAgICApOwogICAgICAgIHN1cGVyLnNlbmQoCiAgICAgICAgICBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgICAgIG5hbWU6IGV2ZW50TmFtZSwKICAgICAgICAgICAgcGF5bG9hZDogZGF0YSwKICAgICAgICAgIH0pLAogICAgICAgICk7CiAgICAgIH07CgogICAgICAvLyBXZSBtYXkgYmUgdHJ5aW5nIHRvIHNlbmQgYmVmb3JlIHRoZSBzb2NrZXQgaXMgb3BlbiBpbiBicm93c2VyIGxhbmQsCiAgICAgIC8vIHNvIGlmIHRoZSBzb2NrZXQncyBub3QgcmVhZHksICJxdWV1ZSIgdGhlIGV2ZW50IHRvIGZpcmUgb24gb3Blbi4KICAgICAgaWYgKHN1cGVyLnJlYWR5U3RhdGUgPT09IDEpIHNlbmRFdmVudCgpOwogICAgICBlbHNlIHN1cGVyLm9ub3BlbiA9IHNlbmRFdmVudDsKCiAgICAgIC8vIEFuZCBtYWtlIHN1cmUgdGhhdCBpZiBubyByZXNwb25zZSBoYXMgb2NjdXJyZWQgd2l0aGluCiAgICAgIC8vIGB0aW1lb3V0YCBtaWxsaXNlY29uZHMsIHdlIGNsZWFuIHVwIHRoZSBsaXN0ZW5lci4KICAgICAgaWYgKGlzRmluaXRlKHRpbWVvdXQpKSB7CiAgICAgICAgc2V0VGltZW91dCgoKSA9PiBjbGVhbnVwKCksIHRpbWVvdXQpOwogICAgICB9CiAgICB9KTsKICB9Cn0KCi8qKgogKiBBIHNvY2tldCBwcm94eSBmb3IgUlBDIHB1cnBvc2VzLgogKi8KY2xhc3MgU29ja2V0UHJveHkgZXh0ZW5kcyBGdW5jdGlvbiB7CiAgY29uc3RydWN0b3Ioc29ja2V0LCByZWNlaXZlciwgcmVtb3RlLCBwYXRoID0gYGApIHsKICAgIHN1cGVyKCk7CiAgICB0aGlzW1JFQ0VJVkVSXSA9IHJlY2VpdmVyOwogICAgdGhpc1tSRU1PVEVdID0gcmVtb3RlOwogICAgdGhpcy5pZCA9IHV1aWQoKTsKICAgIHRoaXMucGF0aCA9IHBhdGg7CiAgICB0aGlzLnNvY2tldCA9IHNvY2tldDsKICAgIHJldHVybiBuZXcgUHJveHkodGhpcywgewogICAgICBnZXQ6IChfLCBwcm9wKSA9PiB7CiAgICAgICAgaWYgKHByb3AgPT09ICJpZCIpIHJldHVybiB0aGlzLmlkOwogICAgICAgIGlmIChwcm9wID09PSAic29ja2V0IikgcmV0dXJuIHRoaXMuc29ja2V0OwogICAgICAgIC8vIEB0cy1pZ25vcmU6IHdlJ3JlIG5ldmVyIGludm9raW5nIHRoaXMgd2l0aCBTeW1ib2wgYXMgc2Vjb25kIGFyZ3VtZW50CiAgICAgICAgcmV0dXJuIG5ldyBTb2NrZXRQcm94eShzb2NrZXQsIHJlY2VpdmVyLCByZW1vdGUsIGAke3BhdGh9OiR7cHJvcH1gKTsKICAgICAgfSwKICAgICAgYXBwbHk6IGFzeW5jIChfLCBfXywgYXJncykgPT4gewogICAgICAgIGlmIChERUJVRykKICAgICAgICAgIGNvbnNvbGUubG9nKAogICAgICAgICAgICBgW1NQYXBwbHldIHNlbmRpbmcgJHt0aGlzLnBhdGguc3Vic3RyaW5nKDEpfSByZWNlaXZlciAkewogICAgICAgICAgICAgIHRoaXNbUkVDRUlWRVJdCiAgICAgICAgICAgIH0gdG8gJHt0aGlzW1JFTU9URV19YCwKICAgICAgICAgICk7CgogICAgICAgIGNvbnN0IGRhdGEgPSBhd2FpdCB0aGlzLnNvY2tldC51cGdyYWRlZC5zZW5kKAogICAgICAgICAgdGhpcy5wYXRoLnN1YnN0cmluZygxKSwKICAgICAgICAgIGFyZ3MsCiAgICAgICAgICB0aGlzW1JFTU9URV0gPT09IEJST1dTRVIgPyBJbmZpbml0eSA6IHVuZGVmaW5lZCwKICAgICAgICApOwoKICAgICAgICBpZiAoZGF0YSBpbnN0YW5jZW9mIFJQQ0Vycm9yKSB7CiAgICAgICAgICBjb25zdCBhcmdzdHIgPSBbLi4ubmV3IEFycmF5KGFyZ3MubGVuZ3RoKV0KICAgICAgICAgICAgLm1hcCgoXywgaSkgPT4gU3RyaW5nLmZyb21DaGFyQ29kZSg5NyArIGkpKQogICAgICAgICAgICAuam9pbihgLGApOwoKICAgICAgICAgIGlmIChERUJVRykKICAgICAgICAgICAgY29uc29sZS5lcnJvcigKICAgICAgICAgICAgICBgRVJST1IgY2FsbGluZyBbWyR7ZGF0YS5vcmlnaW5OYW1lfV1dLiR7dGhpcy5wYXRoCiAgICAgICAgICAgICAgICAuc3Vic3RyaW5nKDEpCiAgICAgICAgICAgICAgICAucmVwbGFjZUFsbChgOmAsIGAuYCl9KCR7YXJnc3RyfSk6ICR7ZGF0YS5tZXNzYWdlfWAsCiAgICAgICAgICAgICk7CgogICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGRhdGEubWVzc2FnZSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gZGF0YTsKICAgICAgfSwKICAgIH0pOwogIH0KfQoKLyoqCiAqIENyZWF0ZSBhIHByb3hpZWQgc29ja2V0IHdoZXJlIHRoZSBjYWxsZXIgbGl0ZXJhbGx5IGRvZXNuJ3QgbmVlZAogKiB0byBjYXJlLCB0aGV5IGp1c3QgbmVlZCB0byBjYWxsIGZ1bmN0aW9ucyBhcyBpZiB0aGV5J3JlIGxvY2Fscy4KICoKICogQHBhcmFtIHtzdHJpbmd9IHJlY2VpdmVyIFRoZSBuYW1lIG9mIHRoZSByZWNlaXZlciBmb3IgdGhpcyBzb2NrZXQKICogQHBhcmFtIHtzdHJpbmd9IHJlbW90ZSBUaGUgbmFtZSBvZiB0aGUgcmVtb3RlIGZvciB0aGlzIHNvY2tldAogKiBAcGFyYW0geyp9IG9yaWdpbiBUaGUgY2FsbGluZyBvYmplY3QsIHVzZWQgZm9yIHRoaW5ncyBsaWtlICJpbGxlZ2FsIGZuYW1lcyIsIHN0YXRlIG1hbmFnZW1lbnQsIGV0Yy4KICogQHBhcmFtIHsqfSBzb2NrZXQgVGhlIHNvY2tldCB3ZSdyZSB3cmFwcGluZy4KICogQHJldHVybnMKICovCmV4cG9ydCBmdW5jdGlvbiBwcm94eVNvY2tldChyZWNlaXZlciwgcmVtb3RlLCBvcmlnaW4sIHNvY2tldCkgewogIHNvY2tldCA9IFVwZ3JhZGVkU29ja2V0LnVwZ3JhZGUoc29ja2V0LCBvcmlnaW4sIHJlY2VpdmVyLCByZW1vdGUpOwogIHJldHVybiAoc29ja2V0W1BST1hZXSA9IG5ldyBTb2NrZXRQcm94eShzb2NrZXQsIHJlY2VpdmVyLCByZW1vdGUpKTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUJyb3dzZXJDbGllbnQoQnJvd3NlckNsaWVudENsYXNzKSB7CiAgICBjb25zdCBwcm9wZXJ0eUNvbmZpZyA9IHsgd3JpdGFibGU6IGZhbHNlLCBjb25maWd1cmFibGU6IGZhbHNlLCBlbnVtZXJhYmxlOiBmYWxzZX07CiAgICBjb25zdCBicm93c2VyQ2xpZW50ID0gbmV3IEJyb3dzZXJDbGllbnRDbGFzcygpOwoKICAgIC8vIGNyZWF0ZSB0aGUgd2ViIHNvY2tldCBjb25uZWN0aW9uIC0gbm90ZSB0aGF0IGlmIHRoZXJlIGFyZSBhbnkgcXVlcnkgYXJndW1lbnRzLAogICAgLy8gdGhvc2Ugd2lsbCBnZXQgcGFzc2VkIGludG8gdGhlIHdlYnNvY2tldCB1cGdyYWRlIHJlcXVlc3QsIHRvby4KICAgIGNvbnN0IHNvY2tldCA9IG5ldyBXZWJTb2NrZXQod2luZG93LmxvY2F0aW9uLnRvU3RyaW5nKCkucmVwbGFjZSgiaHR0cCIsICJ3cyIpKTsKICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShicm93c2VyQ2xpZW50LCAic29ja2V0IiwgewogICAgICAuLi5wcm9wZXJ0eUNvbmZpZywKICAgICAgdmFsdWU6IHNvY2tldCwKICAgIH0pOwoKICAgIC8vIGNyZWF0ZSBhIHByb3h5IGZvciB0aGUgKHdlYmNsaWVudCB0dW5uZWwgdG8gdGhlKSBzZXJ2ZXI6CiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkoYnJvd3NlckNsaWVudCwgInNlcnZlciIsIHsKICAgICAgLi4ucHJvcGVydHlDb25maWcsCiAgICAgIHZhbHVlOiBwcm94eVNvY2tldCgiYnJvd3NlciIsICJ3ZWJjbGllbnQiLCBicm93c2VyQ2xpZW50LCBzb2NrZXQpLAogICAgfSk7CgogICAgYnJvd3NlckNsaWVudC5zdGF0ZSA9IHt9OwogICAgYnJvd3NlckNsaWVudC5pbml0Py4oKTsKICAgIHJldHVybiBicm93c2VyQ2xpZW50OwogIH07CihmdW5jdGlvbihwLHIpeyJvYmplY3QiPT09dHlwZW9mIGV4cG9ydHMmJiJ1bmRlZmluZWQiIT09dHlwZW9mIG1vZHVsZT9yKGV4cG9ydHMpOiJmdW5jdGlvbiI9PT10eXBlb2YgZGVmaW5lJiZkZWZpbmUuYW1kP2RlZmluZShbImV4cG9ydHMiXSxyKToocD0idW5kZWZpbmVkIiE9PXR5cGVvZiBnbG9iYWxUaGlzP2dsb2JhbFRoaXM6cHx8c2VsZixyKHAucmZjNjkwMj17fSkpfSkodGhpcyxmdW5jdGlvbihwKXtmdW5jdGlvbiByKGEpe3JldHVybiBhLnJlcGxhY2UoL34xL2csIi8iKS5yZXBsYWNlKC9+MC9nLCJ+Iil9ZnVuY3Rpb24gRShhKXtyZXR1cm4gYS5yZXBsYWNlKC9+L2csIn4wIikucmVwbGFjZSgvXC8vZywifjEiKX1mdW5jdGlvbiB6KGEpe3JldHVybiB2b2lkIDA9PT1hPyJ1bmRlZmluZWQiOm51bGw9PT1hPyJudWxsIjpBcnJheS5pc0FycmF5KGEpPyJhcnJheSI6dHlwZW9mIGF9ZnVuY3Rpb24gdihhKXtpZihudWxsPT1hfHwib2JqZWN0IiE9dHlwZW9mIGEpcmV0dXJuIGE7CmlmKGEuY29uc3RydWN0b3I9PUFycmF5KXt2YXIgYj1hLmxlbmd0aCxjPUFycmF5KGIpO2ZvcihsZXQgZD0wO2Q8YjtkKyspY1tkXT12KGFbZF0pO3JldHVybiBjfWlmKGEuY29uc3RydWN0b3I9PURhdGUpcmV0dXJuIG5ldyBEYXRlKCthKTtiPXt9O2ZvcihjIGluIGEpdy5jYWxsKGEsYykmJihiW2NdPXYoYVtjXSkpO3JldHVybiBifWZ1bmN0aW9uIEYoe29wOmF9KXtyZXR1cm4icmVtb3ZlIj09PWF8fCJyZXBsYWNlIj09PWF8fCJjb3B5Ij09PWF8fCJtb3ZlIj09PWF9ZnVuY3Rpb24gQShhLGIpe2NvbnN0IGM9e307Zm9yKGNvbnN0IGQgaW4gYSl3LmNhbGwoYSxkKSYmdm9pZCAwIT09YVtkXSYmKGNbZF09MSk7Zm9yKGNvbnN0IGQgaW4gYil3LmNhbGwoYixkKSYmdm9pZCAwIT09YltkXSYmZGVsZXRlIGNbZF07cmV0dXJuIE9iamVjdC5rZXlzKGMpfWZ1bmN0aW9uIEcoYSl7Y29uc3QgYj1hLmxlbmd0aCxjPXt9O2ZvcihsZXQgZD0wO2Q8YjtkKyspe2NvbnN0IGU9YVtkXTtmb3IoY29uc3QgZiBpbiBlKXcuY2FsbChlLApmKSYmdm9pZCAwIT09ZVtmXSYmKGNbZl09KGNbZl18fDApKzEpfWZvcihjb25zdCBkIGluIGMpY1tkXTxiJiZkZWxldGUgY1tkXTtyZXR1cm4gT2JqZWN0LmtleXMoYyl9ZnVuY3Rpb24geChhLGIpe3JldHVybntvcGVyYXRpb25zOmEub3BlcmF0aW9ucy5jb25jYXQoYiksY29zdDphLmNvc3QrMX19ZnVuY3Rpb24gSChhLGIsYyxkPXEpe2Z1bmN0aW9uIGUoayxnKXtjb25zdCBoPWAke2t9LCR7Z31gO3ZhciBsPWZbaF07aWYodm9pZCAwPT09bCl7aWYoMDxrJiYwPGcmJiFkKGFbay0xXSxiW2ctMV0sYy5hZGQoU3RyaW5nKGstMSkpKS5sZW5ndGgpbD1lKGstMSxnLTEpO2Vsc2V7bD1bXTtpZigwPGspe3ZhciB0PWUoay0xLGcpO2wucHVzaCh4KHQse29wOiJyZW1vdmUiLGluZGV4OmstMX0pKX0wPGcmJih0PWUoayxnLTEpLGwucHVzaCh4KHQse29wOiJhZGQiLGluZGV4OmstMSx2YWx1ZTpiW2ctMV19KSkpOzA8ayYmMDxnJiYodD1lKGstMSxnLTEpLGwucHVzaCh4KHQse29wOiJyZXBsYWNlIiwKaW5kZXg6ay0xLG9yaWdpbmFsOmFbay0xXSx2YWx1ZTpiW2ctMV19KSkpO2w9bC5zb3J0KChJLEopPT5JLmNvc3QtSi5jb3N0KVswXX1mW2hdPWx9cmV0dXJuIGx9Y29uc3QgZj17IjAsMCI6e29wZXJhdGlvbnM6W10sY29zdDowfX0sQj1pc05hTihhLmxlbmd0aCl8fDA+PWEubGVuZ3RoPzA6YS5sZW5ndGg7dmFyIHU9aXNOYU4oYi5sZW5ndGgpfHwwPj1iLmxlbmd0aD8wOmIubGVuZ3RoO3U9ZShCLHUpLm9wZXJhdGlvbnM7W3VdPXUucmVkdWNlKChbayxnXSxoKT0+e2lmKCJhZGQiPT09aC5vcCl7dmFyIGw9aC5pbmRleCsxK2c7aD17b3A6aC5vcCxwYXRoOmMuYWRkKGw8QitnP1N0cmluZyhsKToiLSIpLnRvU3RyaW5nKCksdmFsdWU6aC52YWx1ZX07cmV0dXJuW2suY29uY2F0KGgpLGcrMV19aWYoInJlbW92ZSI9PT1oLm9wKXJldHVybiBoPXtvcDpoLm9wLHBhdGg6Yy5hZGQoU3RyaW5nKGguaW5kZXgrZykpLnRvU3RyaW5nKCl9LFtrLmNvbmNhdChoKSxnLTFdO2w9Yy5hZGQoU3RyaW5nKGguaW5kZXgrCmcpKTtoPWQoaC5vcmlnaW5hbCxoLnZhbHVlLGwpO3JldHVybltrLmNvbmNhdCguLi5oKSxnXX0sW1tdLDBdKTtyZXR1cm4gdX1mdW5jdGlvbiBLKGEsYixjLGQ9cSl7Y29uc3QgZT1bXTtBKGEsYikuZm9yRWFjaChmPT57ZS5wdXNoKHtvcDoicmVtb3ZlIixwYXRoOmMuYWRkKGYpLnRvU3RyaW5nKCl9KX0pO0EoYixhKS5mb3JFYWNoKGY9PntlLnB1c2goe29wOiJhZGQiLHBhdGg6Yy5hZGQoZikudG9TdHJpbmcoKSx2YWx1ZTpiW2ZdfSl9KTtHKFthLGJdKS5mb3JFYWNoKGY9PntlLnB1c2goLi4uZChhW2ZdLGJbZl0sYy5hZGQoZikpKX0pO3JldHVybiBlfWZ1bmN0aW9uIHEoYSxiLGMsZD1xKXtpZihhPT09YilyZXR1cm5bXTtjb25zdCBlPXooYSksZj16KGIpO3JldHVybiJhcnJheSI9PWUmJiJhcnJheSI9PWY/SChhLGIsYyxkKToib2JqZWN0Ij09ZSYmIm9iamVjdCI9PWY/SyhhLGIsYyxkKTpbe29wOiJyZXBsYWNlIixwYXRoOmMudG9TdHJpbmcoKSx2YWx1ZTpifV19ZnVuY3Rpb24geShhLApiLGMpe0FycmF5LmlzQXJyYXkoYSk/Ii0iPT1iP2EucHVzaChjKTooYj1wYXJzZUludChiLDEwKSxhLnNwbGljZShiLDAsYykpOmFbYl09Y31mdW5jdGlvbiBDKGEsYil7QXJyYXkuaXNBcnJheShhKT8oYj1wYXJzZUludChiLDEwKSxhLnNwbGljZShiLDEpKTpkZWxldGUgYVtiXX1mdW5jdGlvbiBMKGEsYil7YT1tLmZyb21KU09OKGIucGF0aCkuZXZhbHVhdGUoYSk7aWYobnVsbD09PWEucGFyZW50KXJldHVybiBuZXcgbihiLnBhdGgpO2lmKEFycmF5LmlzQXJyYXkoYS5wYXJlbnQpKXtpZihwYXJzZUludChhLmtleSwxMCk+PWEucGFyZW50Lmxlbmd0aClyZXR1cm4gbmV3IG4oYi5wYXRoKX1lbHNlIGlmKHZvaWQgMD09PWEudmFsdWUpcmV0dXJuIG5ldyBuKGIucGF0aCk7YS5wYXJlbnRbYS5rZXldPWIudmFsdWU7cmV0dXJuIG51bGx9ZnVuY3Rpb24gTShhLGIpe3N3aXRjaChiLm9wKXtjYXNlICJhZGQiOnJldHVybiBhPW0uZnJvbUpTT04oYi5wYXRoKS5ldmFsdWF0ZShhKSx2b2lkIDA9PT0KYS5wYXJlbnQ/Yj1uZXcgbihiLnBhdGgpOih5KGEucGFyZW50LGEua2V5LHYoYi52YWx1ZSkpLGI9bnVsbCksYjtjYXNlICJyZW1vdmUiOnJldHVybiBhPW0uZnJvbUpTT04oYi5wYXRoKS5ldmFsdWF0ZShhKSx2b2lkIDA9PT1hLnZhbHVlP2I9bmV3IG4oYi5wYXRoKTooQyhhLnBhcmVudCxhLmtleSksYj1udWxsKSxiO2Nhc2UgInJlcGxhY2UiOnJldHVybiBMKGEsYik7Y2FzZSAibW92ZSI6dmFyIGM9bS5mcm9tSlNPTihiLmZyb20pLmV2YWx1YXRlKGEpO3ZvaWQgMD09PWMudmFsdWU/Yj1uZXcgbihiLmZyb20pOihhPW0uZnJvbUpTT04oYi5wYXRoKS5ldmFsdWF0ZShhKSx2b2lkIDA9PT1hLnBhcmVudD9iPW5ldyBuKGIucGF0aCk6KEMoYy5wYXJlbnQsYy5rZXkpLHkoYS5wYXJlbnQsYS5rZXksYy52YWx1ZSksYj1udWxsKSk7cmV0dXJuIGI7Y2FzZSAiY29weSI6cmV0dXJuIGM9bS5mcm9tSlNPTihiLmZyb20pLmV2YWx1YXRlKGEpLHZvaWQgMD09PWMudmFsdWU/Yj1uZXcgbihiLmZyb20pOgooYT1tLmZyb21KU09OKGIucGF0aCkuZXZhbHVhdGUoYSksdm9pZCAwPT09YS5wYXJlbnQ/Yj1uZXcgbihiLnBhdGgpOih5KGEucGFyZW50LGEua2V5LHYoYy52YWx1ZSkpLGI9bnVsbCkpLGI7Y2FzZSAidGVzdCI6cmV0dXJuIGE9bS5mcm9tSlNPTihiLnBhdGgpLmV2YWx1YXRlKGEpLGI9cShhLnZhbHVlLGIudmFsdWUsbmV3IG0pLmxlbmd0aD9uZXcgTihhLnZhbHVlLGIudmFsdWUpOm51bGwsYn1yZXR1cm4gbmV3IE8oYil9ZnVuY3Rpb24gUChhKXtmdW5jdGlvbiBiKGMsZCxlKXtjb25zdCBmPWEoYyxkLGUpO3JldHVybiBBcnJheS5pc0FycmF5KGYpP2Y6cShjLGQsZSxiKX1yZXR1cm4gYn1mdW5jdGlvbiBEKGEsYil7YT1tLmZyb21KU09OKGIpLmV2YWx1YXRlKGEpO2lmKHZvaWQgMCE9PWEpcmV0dXJue29wOiJ0ZXN0IixwYXRoOmIsdmFsdWU6YS52YWx1ZX19Y2xhc3MgbXtjb25zdHJ1Y3RvcihhPVsiIl0pe3RoaXMudG9rZW5zPWF9c3RhdGljIGZyb21KU09OKGEpe2NvbnN0IGI9CmEuc3BsaXQoIi8iKS5tYXAocik7aWYoIiIhPT1iWzBdKXRocm93IEVycm9yKGBJbnZhbGlkIEpTT04gUG9pbnRlcjogJHthfWApO3JldHVybiBuZXcgbShiKX10b1N0cmluZygpe3JldHVybiB0aGlzLnRva2Vucy5tYXAoRSkuam9pbigiLyIpfWV2YWx1YXRlKGEpe2xldCBiPW51bGwsYz0iIjtmb3IobGV0IGQ9MSxlPXRoaXMudG9rZW5zLmxlbmd0aDtkPGU7ZCsrKWI9YSxjPXRoaXMudG9rZW5zW2RdLCJfX3Byb3RvX18iIT1jJiYiY29uc3RydWN0b3IiIT1jJiYicHJvdG90eXBlIiE9YyYmKGE9KGJ8fHt9KVtjXSk7cmV0dXJue3BhcmVudDpiLGtleTpjLHZhbHVlOmF9fWdldChhKXtyZXR1cm4gdGhpcy5ldmFsdWF0ZShhKS52YWx1ZX1zZXQoYSxiKXtmb3IobGV0IGM9MSxkPXRoaXMudG9rZW5zLmxlbmd0aC0xLGU9dGhpcy50b2tlbnNbY107YzxkO2MrKylhPShhfHx7fSlbZV07YSYmKGFbdGhpcy50b2tlbnNbdGhpcy50b2tlbnMubGVuZ3RoLTFdXT1iKX1wdXNoKGEpe3RoaXMudG9rZW5zLnB1c2goYSl9YWRkKGEpe2E9CnRoaXMudG9rZW5zLmNvbmNhdChTdHJpbmcoYSkpO3JldHVybiBuZXcgbShhKX19Y29uc3Qgdz1PYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5O2NsYXNzIG4gZXh0ZW5kcyBFcnJvcntjb25zdHJ1Y3RvcihhKXtzdXBlcihgVmFsdWUgcmVxdWlyZWQgYXQgcGF0aDogJHthfWApO3RoaXMucGF0aD1hO3RoaXMubmFtZT0iTWlzc2luZ0Vycm9yIn19Y2xhc3MgTiBleHRlbmRzIEVycm9ye2NvbnN0cnVjdG9yKGEsYil7c3VwZXIoYFRlc3QgZmFpbGVkOiAke2F9ICE9ICR7Yn1gKTt0aGlzLmFjdHVhbD1hO3RoaXMuZXhwZWN0ZWQ9Yjt0aGlzLm5hbWU9IlRlc3RFcnJvciJ9fWNsYXNzIE8gZXh0ZW5kcyBFcnJvcntjb25zdHJ1Y3RvcihhKXtzdXBlcihgSW52YWxpZCBvcGVyYXRpb246ICR7YS5vcH1gKTt0aGlzLm9wZXJhdGlvbj1hO3RoaXMubmFtZT0iSW52YWxpZE9wZXJhdGlvbkVycm9yIn19cC5hcHBseVBhdGNoPWZ1bmN0aW9uKGEsYil7cmV0dXJuIGIubWFwKGM9Pk0oYSxjKSl9OwpwLmNyZWF0ZVBhdGNoPWZ1bmN0aW9uKGEsYixjKXtjb25zdCBkPW5ldyBtO3JldHVybihjP1AoYyk6cSkoYSxiLGQpfTtwLmNyZWF0ZVRlc3RzPWZ1bmN0aW9uKGEsYil7Y29uc3QgYz1bXTtiLmZpbHRlcihGKS5mb3JFYWNoKGQ9Pntjb25zdCBlPUQoYSxkLnBhdGgpO2UmJmMucHVzaChlKTsiZnJvbSJpbiBkJiYoZD1EKGEsZC5mcm9tKSkmJmMucHVzaChkKX0pO3JldHVybiBjfTtPYmplY3QuZGVmaW5lUHJvcGVydHkocCwiX19lc01vZHVsZSIse3ZhbHVlOiEwfSl9KTsK");
